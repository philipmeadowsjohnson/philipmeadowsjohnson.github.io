<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<title data-react-helmet="true">Developer Tips | PhilipMeadowsJohnson</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://philipmeadowsjohnson.github.io/docs/developers/tips"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Developer Tips | PhilipMeadowsJohnson"><meta data-react-helmet="true" name="description" content="Read the puppeteer documentation"><meta data-react-helmet="true" property="og:description" content="Read the puppeteer documentation"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://philipmeadowsjohnson.github.io/docs/developers/tips"><link data-react-helmet="true" rel="alternate" href="https://philipmeadowsjohnson.github.io/docs/developers/tips" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://philipmeadowsjohnson.github.io/docs/developers/tips" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.886598a2.css">
<link rel="preload" href="/assets/js/runtime~main.c6e2d223.js" as="script">
<link rel="preload" href="/assets/js/main.59e5aaa5.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/internaloha-logo.png" alt="InternAloha" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/internaloha-logo.png" alt="InternAloha" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">PhilipMeadowsJohnson</b></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/overview/motivation">Documentation</a><a href="https://github.com/internaloha/scrapers/projects/1" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Project Board<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/internaloha" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleChecked_a04y toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">🌜</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">🌞</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" checked="" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Developer Guide</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developers/overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developers/installation">Installation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developers/invocation">Basic Invocation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developers/process-listings">Developing processListings()</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developers/implementation">Implementation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developers/production">Production</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/developers/tips">Developer Tips</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developers/legal">Legal Issues</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developers/test-scraper">The &quot;Test&quot; Scraper</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developers/resources">Resources</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developers/review-2021-11-08">Review (2021-11-08)</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Documentation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Pilot Studies</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Developer Tips</h1></header><h2 class="anchor anchorWithStickyNavbar_y2LR" id="read-the-puppeteer-documentation">Read the puppeteer documentation<a aria-hidden="true" class="hash-link" href="#read-the-puppeteer-documentation" title="Direct link to heading">​</a></h2><p>It&#x27;s actually quite informative to read the Puppeteer documentation at <a href="https://pptr.dev/" target="_blank" rel="noopener noreferrer">https://pptr.dev/</a>.</p><p>I recommend reading the intro section, and then the <a href="https://pptr.dev/#?product=Puppeteer&amp;version=v10.4.0&amp;show=api-class-page" target="_blank" rel="noopener noreferrer">Page</a> API page, as that is the API you will be using most frequently.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="use-log-levels-appropriately">Use log levels appropriately<a aria-hidden="true" class="hash-link" href="#use-log-levels-appropriately" title="Direct link to heading">​</a></h2><p>While a quick console.log() can be useful during development, please remove them before committing to master. Instead, you should use the built-in logging system to output information to the console according to the following guidelines:</p><p><code>this.log.error()</code>. When you want to indicate that a non-recoverable error has occurred, call <code>this.log.error()</code>. That said, it&#x27;s probably more convenient to simply throw an Error for code in <code>login()</code>, <code>launch()</code>, <code>generateListings()</code>, or <code>processListings()</code>. That&#x27;s because these errors will be caught by the superclass and a <code>this.log.error()</code> will be invoked automatically.</p><p><code>this.log.warn()</code>.  When something exceptional happens that you think should be highlighted, use <code>this.log.warn()</code>.  This logging level is also used to indicate that a scraper has started.  Running a scraper with logging set to <code>warn</code> means that there will typically be only one line of output under normal conditions.</p><p><code>this.log.info()</code>. This is the default level of logging. The goal of &quot;info&quot; logging is to provide the user with feedback that enables them to know that the scraper is making progress, but without overwhelming them with output. Try to be judicious. For example, if your scraper is normally going to go through 90 pages, maybe emit an info message every 5 or 10 pages so that there aren&#x27;t 90 lines of output.</p><p><code>this.log.debug()</code>. You can emit as much output as you want at the debug level. Note that the Scraper superclass sets up an event handler such that all output to the puppeteer console is logged at the debug level. So, when you run a scraper with logging set to debug, you might get lines of output similar to this:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">09:38:07 DEBUG LINKEDIN PUPPETEER CONSOLE: visitor.publishDestinations() result: The destination publishing iframe is already attached and loaded.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">09:38:07 DEBUG LINKEDIN PUPPETEER CONSOLE: Failed to load resource: the server responded with a status of 400 ()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>It can be very informative to see what is being printed to the puppeteer console, although some of this output might not have been generated by your scraper!</p><p><code>this.log.trace()</code>. Calling this will emit a stack trace at the moment of invocation.</p><p>So, for example, here is the default output for the NSF scraper:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ npm run scrape -- -s nsf</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&gt; scraper@2.0.0 scrape</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&gt; ts-node -P tsconfig.buildScripts.json scrape.ts &quot;-s&quot; &quot;nsf&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">12:21:06 WARN NSF Launching NSF scraper</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">12:21:10 INFO NSF Wrote 100 listings.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">12:21:10 INFO NSF Wrote statistics.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Since this scraper runs quickly, there&#x27;s no need to augment the built-in logging messages.</p><p>On the other hand, the Simply Hired scraper default (info) output might best look like this:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ npm run scrape -- -s simplyhired</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&gt; scraper@2.0.0 scrape</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&gt; ts-node -P tsconfig.buildScripts.json scrape.ts &quot;-s&quot; &quot;simplyhired&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">12:24:03 WARN SIMPLYHIRED Launching SIMPLYHIRED scraper</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">12:24:23 INFO SIMPLYHIRED Processed page 1, 19 internships</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">12:26:07 INFO SIMPLYHIRED Processed page 10, 152 internships</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">12:27:49 INFO SIMPLYHIRED Processed page 20, 279 internships</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">12:29:23 INFO SIMPLYHIRED Processed page 30, 399 internships</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">12:30:59 INFO SIMPLYHIRED Processed page 40, 519 internships</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">12:32:38 INFO SIMPLYHIRED Processed page 50, 646 internships</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">12:34:37 INFO SIMPLYHIRED Processed page 60, 798 internships</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">12:36:59 INFO SIMPLYHIRED Processed page 70, 983 internships</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">12:39:15 INFO SIMPLYHIRED Processed page 80, 1163 internships</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">12:41:28 INFO SIMPLYHIRED Processed page 90, 1343 internships</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">12:41:54 INFO SIMPLYHIRED Reached the end of pages!</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">12:41:54 INFO SIMPLYHIRED Wrote 1377 listings.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">12:41:54 INFO SIMPLYHIRED Wrote statistics.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>In this case, there&#x27;s about 90 seconds delay between each line of output. You can write code like this to elide output in info mode but print it all out in debug mode.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">const message = `Processed page ${totalPages}, ${internshipsPerPage} internships`;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">((totalPages === 1) || (totalPages % 10 === 0)) ? this.log.info(message) : this.log.debug(message);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="avoid-pageevaluate">Avoid <code>page.evaluate()</code><a aria-hidden="true" class="hash-link" href="#avoid-pageevaluate" title="Direct link to heading">​</a></h2><p>The FAQ section of <a href="https://pptr.dev/" target="_blank" rel="noopener noreferrer">https://pptr.dev/</a> has a question entitled &quot;What’s the difference between a “trusted&quot; and &quot;untrusted&quot; input event?&quot;. It turns out that to avoid sites from blocking us as robots, we should always generate &quot;trusted&quot; events. This means that we should avoid the use of <code>page.evaluate()</code>, which generates untrusted events. Here&#x27;s a quote from the docs:</p><p><em>For automation purposes it’s important to generate trusted events. All input events generated with Puppeteer are trusted and fire proper accompanying events. If, for some reason, one needs an untrusted event, it’s always possible to hop into a page context with page.evaluate and generate a fake event:</em></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> page</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">evaluate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token dom variable" style="color:rgb(189, 147, 249);font-style:italic">document</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">querySelector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;button[type=submit]&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">click</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>We definitely want to avoid &quot;fake events&quot;, because certain sites might use them to bar us from scraping them. Note that it&#x27;s OK to use page.evaluate() if you aren&#x27;t generating events (i.e. you are just inspecting the page contents).  You should avoid things like .click() inside page.evaluate().</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="prefer-await-supergetvalues-or-supergetvalue">Prefer await super.getValues() or super.getValue()<a aria-hidden="true" class="hash-link" href="#prefer-await-supergetvalues-or-supergetvalue" title="Direct link to heading">​</a></h2><p>Many scrapers implement code similar to this:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">async</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">oldVersionOfGetValues</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">selector</span><span class="token parameter punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token parameter"> field</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> returnVals </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">page</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">evaluate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">selector</span><span class="token parameter punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token parameter"> field</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> vals </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> nodes </span><span class="token operator">=</span><span class="token plain"> </span><span class="token dom variable" style="color:rgb(189, 147, 249);font-style:italic">document</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">querySelectorAll</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">selector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    nodes</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">forEach</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">node</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> vals</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">push</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">node</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">field</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> vals</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> selector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> field</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> returnVals</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>I then discovered after studying the Puppeteer documentation that it could be replaced with a one-liner using <code>page.$$eval</code>:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">async</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">getValues</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">selector</span><span class="token parameter punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token parameter"> field</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">page</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">$$eval</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">selector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">nodes</span><span class="token parameter punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token parameter"> field</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> nodes</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">map</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">node</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> node</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">field</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> field</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This is used sufficiently often that it is now present in the Scraper.ts superclass. So, you should replace code similar to oldVersionOfGetValues with super.getValues().</p><p>If you are only looking for a single instance of the element, then use super.getValue(), which returns the element directly, not in a list.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="page-navigation-patterns">Page navigation patterns<a aria-hidden="true" class="hash-link" href="#page-navigation-patterns" title="Direct link to heading">​</a></h2><p>There are two standard ways to navigate:</p><ol><li>Request a url directly.</li><li>Click on a button or a link to navigate.</li></ol><p>In the first case, you use super.goto(). For example:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">super</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">goto</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">url</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>In the case of following a link or clicking a button, you need to use a more complicated piece of code:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> </span><span class="token known-class-name class-name">Promise</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">all</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">page</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">click</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;input[class=&quot;c-button c-button--blue s-vgPadLeft1_5 s-vgPadRight1_5&quot;]&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">page</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">waitForNavigation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This code ensures that both the click() and the waitForNavigation() complete before the script proceeds to the next command.</p><p>For more details, see <a href="https://pptr.dev/#?product=Puppeteer&amp;version=v10.4.0&amp;show=api-pagewaitfornavigationoptions" target="_blank" rel="noopener noreferrer">https://pptr.dev/#?product=Puppeteer&amp;version=v10.4.0&amp;show=api-pagewaitfornavigationoptions</a>.</p><p>Just to be clear: if you use <code>super.goto()</code>, you don&#x27;t need to add <code>page.waitForNavigation()</code>.  See <a href="https://stackoverflow.com/a/57881877/2038293" target="_blank" rel="noopener noreferrer">https://stackoverflow.com/a/57881877/2038293</a> for details.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="prefer-await-superselectorexists">Prefer await super.selectorExists()<a aria-hidden="true" class="hash-link" href="#prefer-await-superselectorexists" title="Direct link to heading">​</a></h2><p>There are lots of situations in which you want to do some processing as long as there&#x27;s at least one occurrence of a selector on the page.  Because this is such a common pattern, the Scraper superclass provides a simple method for this:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> * Return true if the passed selector appears on the page.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">async selectorExists(selector) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  return !! await this.page.$(selector);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This makes it more readable to write loops:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">const listingSelector = &#x27;#listing&#x27;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">this.page.goto(getUrl());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">while (await super.selectorExists(listingSelector)) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  // process listings on this page.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  this.page.goto(getNextUrl());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="be-kind-to-future-you">Be kind to future you<a aria-hidden="true" class="hash-link" href="#be-kind-to-future-you" title="Direct link to heading">​</a></h2><p>&quot;Future you&quot; refers to you in several months when you have been working on other things, but have to come back to fix a broken scraper.  Being kind of future you means structuring your code in such a way that it is easier to re-understand.  Here are some tips:</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="provide-meaningful-variable-names-to-document-magic-strings">Provide meaningful variable names to document &quot;magic&quot; strings<a aria-hidden="true" class="hash-link" href="#provide-meaningful-variable-names-to-document-magic-strings" title="Direct link to heading">​</a></h4><p>Consider the following line of code:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">await this.page.waitForSelector(&#x27;a[class=&quot;styles_component__1c6JC styles_defaultLink__1mFc1 styles_information__1TxGq&quot;]&#x27;);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>What, precisely are we waiting for?  The problem here is that the meaning of this selector string is opaque: it doesn&#x27;t provide us with any information about what it is, where it might be, and why we might be waiting for it.</p><p>One good way to fix this is to assign that string to a variable whose name provides more information:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">const internshipLink = &#x27;a[class=&quot;styles_component__1c6JC styles_defaultLink__1mFc1 styles_information__1TxGq&quot;]&#x27;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">await this.page.waitForSelector(internshipLink);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>A benefit of this approach over simply adding a comment string is that if you want to inspect the page manually using DevTools, you can simply copy-and-paste the line containing the variable definition into the DevTools console, which makes it easy to replicate the query using non-Puppeteer Dev Tools operations such as:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">document.querySelector(internshipLink)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="avoid-deep-nesting">Avoid deep nesting<a aria-hidden="true" class="hash-link" href="#avoid-deep-nesting" title="Direct link to heading">​</a></h4><p>If your code has an if statement inside a while loop inside an if statement, for example, it will be hard to read.</p><p>In these cases, think about how to modularize your code. Maybe there is a block of code that can be refactored into a private method with a useful return value.  That is useful for understanding, and also for debugging.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="dont-use-try-catch-to-provide-normal-control-flow">Don&#x27;t use try-catch to provide &quot;normal&quot; control flow<a aria-hidden="true" class="hash-link" href="#dont-use-try-catch-to-provide-normal-control-flow" title="Direct link to heading">​</a></h2><p>Consider the following code:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// Click the &quot;Load More&quot; button</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">page</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">click</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;.load_more_jobs&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">err</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">debug</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;--- All jobs are Listed, no &quot;Load More&quot; button --- &#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>What is problematic about this code is that it is not an error for a page to not have a Load More button. So, the use of try-catch is not appropriate.</p><p>In this case, what is needed is to test whether or not the selector exists and only click it if so:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> loadJobsSelector </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;load_more_jobs&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">super</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">selectorExists</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">loadJobsSelector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">page</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">click</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token template-string string" style="color:rgb(255, 121, 198)">.</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">${</span><span class="token template-string interpolation">loadJobsSelector</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>It doesn&#x27;t seem particularly interesting to provide the debugging log statement, so I&#x27;ve omitted it, but you could add it back in if you really wanted it as an else clause.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="error-navigation-failed-because-browser-has-disconnected">&quot;Error: Navigation failed because browser has disconnected!&quot;<a aria-hidden="true" class="hash-link" href="#error-navigation-failed-because-browser-has-disconnected" title="Direct link to heading">​</a></h2><p>Are you experiencing an intermittent error similar to this?</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">10:37:59 ERROR APPLE Execution context was destroyed, most likely because of a navigation.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(node:95928) UnhandledPromiseRejectionWarning: Error: Navigation failed because browser has disconnected!</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    at /Users/philipjohnson/github/internaloha/internaloha/scrapers-v2/node_modules/puppeteer/lib/cjs/puppeteer/common/LifecycleWatcher.js:51:147</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>According to <a href="https://stackoverflow.com/questions/54527982/why-is-puppeteer-reporting-unhandledpromiserejectionwarning-error-navigation" target="_blank" rel="noopener noreferrer">this stackoverflow page</a>, <em>The &quot;Navigation failed because browser has disconnected&quot; error usually means that the node scripts that launched Puppeteer ends without waiting for the Puppeteer actions to be completed.</em></p><p>The stackoverflow answer goes on to debug the specific code in question, but there is a much more general answer:</p><p><em>Be sure that you preface every Puppeteer operation (i.e. <code>this.page.&lt;operation&gt;</code>) with <code>await</code>.</em></p><p>For example, there was some scraper code that generated this error occasionally. On review, the following lines were discovered:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">page</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">goto</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token function" style="color:rgb(80, 250, 123)">pageUrl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">++</span><span class="token plain">pageNum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">waitUntil</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;networkidle2&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">page</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">waitForTimeout</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">3000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Because the <code>this.page.goto</code> was not proceeded with an <code>await</code>, that line of code returned immediately. The next line of code forced a wait of 3 seconds, which might or might not be enough time for the <code>goto</code> to complete successfully. If it is enough time, then everything would be OK. If it is not enough time, then we&#x27;d get the error.</p><p>The solution is to simply add the <code>await</code>, which also means we don&#x27;t need the <code>waitForTimeout</code>:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">page</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">goto</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token function" style="color:rgb(80, 250, 123)">pageUrl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">++</span><span class="token plain">pageNum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">waitUntil</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;networkidle2&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>So, if you are getting this error intermittently, a quick thing to do is a search for every occurrence of <code>this.page</code> in your scraper code, and verify that every occurrence of <code>this.page</code> is preceded by <code>await</code>.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="how-to-determine-if-a-page-has-finished-loading">How to determine if a page has finished loading<a aria-hidden="true" class="hash-link" href="#how-to-determine-if-a-page-has-finished-loading" title="Direct link to heading">​</a></h2><p>One issue with scraper design is to ensure that the scraper does not try to operate on a page until it has loaded.</p><p>A common strategy in prior scraper implementations is to liberally insert code to insert pauses into script execution. For example, the following code pauses the script for 3 seconds each time it is executed:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">await this.page.waitForTimeout(3000);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>There are two problems with this approach:</p><ol><li>It is hard to figure out the appropriate length of time to pause. Is 3 seconds enough for all situations?</li><li>It might slow down script execution significantly. If you insert a 3 second pause into a loop for each listing, and there are 500 listings, then you&#x27;ve just forced your script to require a minimum of 1500 seconds to execute.</li></ol><p>Some times these pauses are inserted to mimic human &quot;speed&quot; of page manipulation, but this is only needed for a few scrapers. More often, these pauses end up being inserted as a way to wait until the page is loaded.</p><p><a href="https://stackoverflow.com/questions/52497252/puppeteer-wait-until-page-is-completely-loaded" target="_blank" rel="noopener noreferrer">This stackoverflow page</a> has a number of comments regarding this issue.  From it, we can get a number of hints about how to best wait until a page has loaded.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="case-1-when-you-know-a-selector-will-eventually-exist-on-the-page">Case 1: When you know a selector will (eventually) exist on the page<a aria-hidden="true" class="hash-link" href="#case-1-when-you-know-a-selector-will-eventually-exist-on-the-page" title="Direct link to heading">​</a></h3><p>If you are <strong>sure</strong> that a page, when finally loaded, will contain the selector of interest, then your best approach is to use <a href="https://github.com/puppeteer/puppeteer/blob/main/docs/api.md#pagewaitforselectorselector-options" target="_blank" rel="noopener noreferrer">page.waitForSelector()</a>. By default, the timeout is &#x27;0&#x27;, which means that this command will wait indefinitely for the selector to be present on the page.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="case-2-when-you-dont-know-if-a-selector-will-ever-exist-on-the-page">Case 2: When you don&#x27;t know if a selector will (ever) exist on the page<a aria-hidden="true" class="hash-link" href="#case-2-when-you-dont-know-if-a-selector-will-ever-exist-on-the-page" title="Direct link to heading">​</a></h3><p>If you are not sure that the selector of interest will exist, then things are more complicated, since you don&#x27;t know if the absence of the selector is due to the selector not being present or the page not having completed loading.</p><p>First, it is important to understand that completing the &quot;loading&quot; process has two phases:</p><ol><li>Complete the downloading of all page resources (HTML, Javascript, Images, etc) from the server over the network.</li><li>Complete the execution of all Javascript scripts on the page, since these scripts might create DOM elements.</li></ol><p>To address (1), you can use the <code>waitUntil</code> option of commands like <code>page.goto</code>, as documented <a href="https://github.com/puppeteer/puppeteer/blob/main/docs/api.md#pagegotourl-options" target="_blank" rel="noopener noreferrer">here</a>.  If you experience loading issues, then you might add this option with a value of <code>networkidle0</code>.  Please note that you do not need to set <code>timeout</code>, as it is set to <code>0</code> globally by the scraper superclass.</p><p>In some cases, a page might have time-consuming Javascript scripts that execute. If you can verify that this is an issue in the site you are scraping, then you might want to consider the <code>waitTillHTMLRendered</code> function, documented in <a href="https://stackoverflow.com/a/61304202/2038293" target="_blank" rel="noopener noreferrer">this stackoverflow answer</a>.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="try-using-the-google-cache">Try using the Google Cache<a aria-hidden="true" class="hash-link" href="#try-using-the-google-cache" title="Direct link to heading">​</a></h2><p>If you are getting blocked by the site, see if you can scrape the Google cache version.  Instructions are <a href="https://webscraping.com/blog/Using-Google-Cache-to-crawl-a-website/" target="_blank" rel="noopener noreferrer">here</a>. Basically, you just need to prepend “<a href="http://webcache.googleusercontent.com/search?q=cache:%E2%80%9D" target="_blank" rel="noopener noreferrer">http://webcache.googleusercontent.com/search?q=cache:”</a> to the beginning of the URL.</p><p>While this can result in a somewhat out-of-date version of the site, it&#x27;s normally just a few days or weeks old, which is plenty recent enough for us.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="add-throttling-and-variation">Add throttling and variation<a aria-hidden="true" class="hash-link" href="#add-throttling-and-variation" title="Direct link to heading">​</a></h2><p>Some sites monitor how fast requests come from a particular IP address, and block if they come in too fast or are too regular.</p><p>The <code>slomo</code> command line argument creates a lower bound on how fast the scraper issues HTTP requests. This is good when developing the system with <code>no-headless</code>. However, this is often more slow than is necessary for production, and does not support variation between navigation.</p><p>To prevent the scraper from traversing to pages too quickly, the <code>super.goto()</code> method provides a drop-in replacement for <code>this.page.goto()</code> which adds a random delay between 1 second and <code>super.maxRandomWait</code> milliseconds (which currently defaults to 5000). So, use this method to automatically throttle your scraper&#x27;s frequency of page requests, and to add some variation. You can change the <code>maxRandomWait</code> variable in your constructor if you determine you need a different level of variability.</p><p>However, this approach won&#x27;t work if you navigate using <code>this.page.click()</code>. In this case, you will have to manually insert a pause.  To make it easier to wait a random amount of time, you can use <code>super.randomWait()</code>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_mt2f"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2021-12-02T17:51:07.000Z">12/2/2021</time></b> by <b>Philip Johnson</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/developers/production"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« <!-- -->Production</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/developers/legal"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Legal Issues<!-- --> »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#read-the-puppeteer-documentation" class="table-of-contents__link toc-highlight">Read the puppeteer documentation</a></li><li><a href="#use-log-levels-appropriately" class="table-of-contents__link toc-highlight">Use log levels appropriately</a></li><li><a href="#avoid-pageevaluate" class="table-of-contents__link toc-highlight">Avoid <code>page.evaluate()</code></a></li><li><a href="#prefer-await-supergetvalues-or-supergetvalue" class="table-of-contents__link toc-highlight">Prefer await super.getValues() or super.getValue()</a></li><li><a href="#page-navigation-patterns" class="table-of-contents__link toc-highlight">Page navigation patterns</a></li><li><a href="#prefer-await-superselectorexists" class="table-of-contents__link toc-highlight">Prefer await super.selectorExists()</a></li><li><a href="#be-kind-to-future-you" class="table-of-contents__link toc-highlight">Be kind to future you</a></li><li><a href="#dont-use-try-catch-to-provide-normal-control-flow" class="table-of-contents__link toc-highlight">Don&#39;t use try-catch to provide &quot;normal&quot; control flow</a></li><li><a href="#error-navigation-failed-because-browser-has-disconnected" class="table-of-contents__link toc-highlight">&quot;Error: Navigation failed because browser has disconnected!&quot;</a></li><li><a href="#how-to-determine-if-a-page-has-finished-loading" class="table-of-contents__link toc-highlight">How to determine if a page has finished loading</a><ul><li><a href="#case-1-when-you-know-a-selector-will-eventually-exist-on-the-page" class="table-of-contents__link toc-highlight">Case 1: When you know a selector will (eventually) exist on the page</a></li><li><a href="#case-2-when-you-dont-know-if-a-selector-will-ever-exist-on-the-page" class="table-of-contents__link toc-highlight">Case 2: When you don&#39;t know if a selector will (ever) exist on the page</a></li></ul></li><li><a href="#try-using-the-google-cache" class="table-of-contents__link toc-highlight">Try using the Google Cache</a></li><li><a href="#add-throttling-and-variation" class="table-of-contents__link toc-highlight">Add throttling and variation</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">InternAloha is sponsored by:<br>
                  <a href="http://csdl.ics.hawaii.edu">Collaborative Software Development Laboratory</a><br>
                  <a href="http://www.ics.hawaii.edu">Department of Information and Computer Sciences</a><br>
                  <a href="http://www.hawaii.edu">University of Hawaii</a><br>
                  with funding from the National Science Foundation (Awards 1829542, 2025112)</div></div></div></footer></div>
<script src="/assets/js/runtime~main.c6e2d223.js"></script>
<script src="/assets/js/main.59e5aaa5.js"></script>
</body>
</html>